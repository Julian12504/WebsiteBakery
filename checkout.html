<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thanh To√°n ƒê∆°n H√†ng</title>
    <link rel="icon" type="image/png" href="img/cake.png">

    <link rel="stylesheet" href="./assets/client_style.css"> 
    <link rel="stylesheet" href="./assets/client_checkout_user.css"> 
</head>
<body>
    
    <script>
        // Y√™u c·∫ßu client_auth.js ph·∫£i c√≥ h√†m getCurrentUser()
        if (!localStorage.getItem('client_user_data')) {
            alert('B·∫°n c·∫ßn ƒëƒÉng nh·∫≠p ƒë·ªÉ ti·∫øn h√†nh thanh to√°n.');
            window.location.href = 'login.html'; // Chuy·ªÉn h∆∞·ªõng v·ªÅ trang ƒëƒÉng nh·∫≠p
        }
    </script>

    <header class="main-header">
    <a href="index2.html" class="logo-wrap">
    <img src="img/cake.png" alt="Logo Ti·ªám B√°nh Cao C·∫•p" class="logo">
    <h1>TI·ªÜM B√ÅNH XYZ</h1>
</a>
        <nav class="main-nav">
            <span id="client-welcome-msg" style="display: none; margin-right: 5px; color: #333;"></span> 
                <a href="contact2.html" class="active">Li√™n H·ªá</a>
            <a href="index2.html">Trang Ch·ªß</a>
            <a href="product_list2.html">S·∫£n Ph·∫©m</a>
            <a href="cart.html" class="cart-icon active">üõí Gi·ªè H√†ng (<span id="cart-count">0</span>)</a> 
            <a href="user_profile.html">H·ªì s∆°</a>
            <a href="login.html" id="client-auth-link">ƒêƒÉng Nh·∫≠p</a> 
        </nav>
    </header>

    <main class="checkout-page-content">
        <p><a href="cart.html">‚Üê Quay l·∫°i Gi·ªè h√†ng</a></p>
        <h2>üßæ X√ÅC NH·∫¨N V√Ä THANH TO√ÅN</h2>
        
        <form class="checkout-form" id="checkout-form">
            <div class="shipping-info">
                <h3>1. Th√¥ng Tin Giao H√†ng</h3>
                
                <label>
                    <input type="radio" name="address_option" value="account" id="use-account-address" checked> 
                    S·ª≠ d·ª•ng ƒë·ªãa ch·ªâ t√†i kho·∫£n: 
                    <span id="account-address-display" style="font-weight: bold; color: #4CAF50;">[ƒê·ªãa ch·ªâ chi ti·∫øt c·ªßa ng∆∞·ªùi d√πng]</span>
                </label>
                <br>
                <label>
                    <input type="radio" name="address_option" value="new" id="use-new-address"> Giao ƒë·∫øn ƒë·ªãa ch·ªâ m·ªõi
                </label>

                <div id="new-address-fields" style="margin-top: 15px; display: none;">
                    <label for="fullname">H·ªç v√† T√™n ng∆∞·ªùi nh·∫≠n:</label>
                    <input type="text" id="fullname" placeholder="Nh·∫≠p h·ªç t√™n">
                    
                    <label for="phone">S·ªë ƒëi·ªán tho·∫°i:</label>
                    <input type="tel" id="phone" placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i">

                    <label for="address_detail">ƒê·ªãa ch·ªâ chi ti·∫øt (S·ªë nh√†, ƒë∆∞·ªùng, ph∆∞·ªùng/x√£):</label>
                    <textarea id="address_detail" rows="3" placeholder="V√≠ d·ª•: S·ªë 123, ƒë∆∞·ªùng A, ph∆∞·ªùng B, qu·∫≠n C"></textarea>
                </div>
                
                <label for="note" style="margin-top: 15px; display: block;">Ghi ch√∫ (Y√™u c·∫ßu vi·∫øt ch·ªØ l√™n b√°nh, th·ªùi gian giao, v.v.):</label>
                <textarea id="note" rows="2" placeholder="V√≠ d·ª•: Vi·∫øt 'Happy Birthday' l√™n b√°nh. Giao v√†o 14:00 chi·ªÅu."></textarea>
            </div>

            <div class="order-summary-box">
                <div class="payment-method">
                    <h3>2. H√¨nh Th·ª©c Thanh To√°n</h3>
                    <label><input type="radio" name="payment" value="cod" checked> Thanh to√°n khi nh·∫≠n h√†ng (COD)</label>
                    <label><input type="radio" name="payment" value="bank"> Chuy·ªÉn kho·∫£n ng√¢n h√†ng</label>
                </div>

                <div class="order-summary">
                    <h3>3. T√≥m T·∫Øt ƒê∆°n H√†ng</h3>
                    <div id="checkout-summary-details">
                        <p>T·∫°m t√≠nh (<span id="summary-item-count">0</span> SP): <span id="summary-subtotal">0 VNƒê</span></p>
                        <p>Ph√≠ v·∫≠n chuy·ªÉn: <span id="summary-shipping">30.000 VNƒê</span></p>
                        <hr>
                        <p class="total-final">T·ªïng Thanh To√°n: <span id="summary-total">0 VNƒê</span></p>
                    </div>
                    
                    <button type="submit" class="btn-primary btn-place-order">HO√ÄN T·∫§T ƒê·∫∂T H√ÄNG</button>
                    <p style="font-size: 0.8em; text-align: center; margin-top: 10px;">B·∫±ng c√°ch ƒë·∫∑t h√†ng, b·∫°n ƒë·ªìng √Ω v·ªõi c√°c ƒëi·ªÅu kho·∫£n c·ªßa ch√∫ng t√¥i.</p>
                </div>
            </div>
        </form>
    </main>


    
    <script src="./assets/client_auth.js"></script> 
    <script src="./assets/cart_script.js"></script>
    <script src="./assets/client_script.js"></script> 

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const newAddressRadio = document.getElementById('use-new-address');
            const newAddressFields = document.getElementById('new-address-fields');
            const accountAddressRadio = document.getElementById('use-account-address');
            const accountAddressDisplay = document.getElementById('account-address-display');

            // --- GI·∫¢ L·∫¨P ƒê·ªäA CH·ªà T√ÄI KHO·∫¢N (Thay th·∫ø b·∫±ng logic JS th·ª±c t·∫ø sau n√†y) ---
            const defaultAddress = "L√™ Thanh H√πng, 0938176419 - D4/14, PK9, T√¢n Nh·ª±t, B√¨nh Ch√°nh TP. HCM";
            if (accountAddressDisplay) {
                accountAddressDisplay.textContent = defaultAddress;
            }
            // --------------------------------------------------------------------------

            // H√†m x·ª≠ l√Ω vi·ªác hi·ªÉn th·ªã/·∫©n tr∆∞·ªùng ƒë·ªãa ch·ªâ m·ªõi
            const toggleAddressFields = () => {
                if (newAddressRadio.checked) {
                    newAddressFields.style.display = 'block';
                    // B·∫≠t thu·ªôc t√≠nh required khi hi·ªÉn th·ªã
                    newAddressFields.querySelectorAll('input, textarea').forEach(el => el.required = true);
                } else {
                    newAddressFields.style.display = 'none';
                    // T·∫Øt thu·ªôc t√≠nh required khi ·∫©n
                    newAddressFields.querySelectorAll('input, textarea').forEach(el => el.required = false);
                }
            };

            newAddressRadio.addEventListener('change', toggleAddressFields);
            accountAddressRadio.addEventListener('change', toggleAddressFields);
            
            // Kh·ªüi t·∫°o tr·∫°ng th√°i form (m·∫∑c ƒë·ªãnh l√† ·∫©n)
            toggleAddressFields();

        });
    </script>
    <script>
    // T√¨m c√°i Form
    const checkoutForm = document.getElementById('checkout-form');

    // B·∫Øt s·ª± ki·ªán khi b·∫•m n√∫t "HO√ÄN T·∫§T ƒê·∫∂T H√ÄNG" (s·ª± ki·ªán submit)
    checkoutForm.addEventListener('submit', function(e) {
        
        // 1. D√≤ng quan tr·ªçng nh·∫•t: NgƒÉn kh√¥ng cho trang web t·ª± load l·∫°i
        e.preventDefault(); 

        // 2. Code chuy·ªÉn h∆∞·ªõng sang trang b·∫°n mu·ªën
        window.location.href = 'order_confirmation.html'; 
    });
</script>
</body>
</html>